<html>
<head>
<title>LDAP Address Book - Getting Started</title>
<link rel="stylesheet" href="styles.css" type="text/css">
<link rel="icon" type="image/png" href="addressbook24.png">
</head>
<body>

<h1>
<img alt="LDAP Address Book Icon" src="addressbook48.png">
LDAP Address Book
</h1>
<hr>
<h2>Contents</h2>

<ol>
<li>Getting Started Using the Address Book
  <ol>
  <li>Using OpenSearch
  </ol>
<li>Initial Installation and Setup
  <ol>
  <li>Installation on Linux: Apache HTTP Server on Debian/Ubuntu
  <li>Installation on Windows: Apache HTTP Server or Microsoft IIS
  <li>Set up access to the directory service
  </ol>
<li>Customising the Address Book
  <ol>
  <li>Configuring users and permissions
  <li>Changing the attributes shown for search results
  <li>Changing the layout and attributes shown for directory entries
  <li>Changing the look and formatting of the address book
  </ol>
<li>Configuration reference
</ol>
<hr>
<h2>Getting Started Using the Address Book</h2>
<p>
LDAP Address Book is a web application for browsing and searching
for contact details within an LDAP directory service. It has been
tested on the following LDAP directories:
</p>
<ul>
<li>Active Directory (Microsoft and Samba implementations)
<li>Novell eDirectory
<li>OpenLDAP (provisional support)
</ul>
<p>
Searching your LDAP address book is pretty easy. Just type in
the name, job title or company of who you're trying to find into
search box and click "Search" (or press Return). Alternatively
if the directory has been classified into "organisational units"
you can click on the folders underneath the search box to browse
records by department, building, etc.
</p>
<h3>Using OpenSearch</h3>
<img alt="Address book OpenSearch integration" src="opensearch.png">
<p>
You can add the LDAP Address Book to the drop-down list of search engines
in Firefox and other OpenSearch-compliant browsers. To the Address Book
add as a Firefox search engine:
</p>
<ol>
<li>Open web browser and navigate to the address book.
<li>Click the icon to the left of the search engine name in the search
box.
<li>Select <b>Add "LDAP Address Book"</b> (or the current value of
$site_name in the config, if changed from the default) from the menu.
</ol>
<hr>
<h2>Initial Installation and Setup</h2>
<p>
The remainder of this document is aimed towards system administrators
setting up and configuring LDAP address book on your network.
</p>
<h3>Installation on Linux: Apache HTTP Server on Debian/Ubuntu</h3>
<p>
Install Apache HTTP Server, together with PHP and PHP/LDAP integration:
</p>
<pre>
apt-get install apache2 php5 libapache2-mod-php5 php5-ldap
</pre>
<p>
Decide where you want to store the address book web site's files
and unpack the address book tar.gz file to the web site directory.
For the purposes of this guide, this location is assumed to be
<code>/srv/www/addressbook.example.org</code> and the URL of the
address book <code>http://addressbook.example.org/</code>, in
which case you might type:
</p>
<pre>
mkdir -p /srv/www/addressbook.example.org
cd /srv/www/addressbook.example.org
tar xvzf ~/ldap-addr-book-0.02.tar.gz
</pre>
<p>
Create the file /etc/apache2/sites-available/addressbook.example.org, contents as follows
</p>
<pre>
&lt;VirtualHost *:80&gt;
        DocumentRoot /srv/www/addressbook.example.org
        ServerAdmin webmaster@example.org
        ServerName addressbook.example.org

        ServerSignature email
        DirectoryIndex index.html index.php

        LogFormat "combined"
        TransferLog /var/log/apache2/addressbook.example.org-access_log
        ErrorLog /var/log/apache2/addressbook.example.org-error_log
&lt;/VirtualHost&gt;
</pre>
<p>
Enable the site by running the command:
</p>
<p>
<code>a2ensite addressbook.example.org</code>
</p>
<p>
Perform a graceful restart of Apache in order to re-read the
configuration and make the new web site live:
</p>
<p>
<code>apache2ctl graceful</code>
</p>

<p>
Finally create a DNS record for the address book web site, e.g.:
</p>
<pre>addressbook.example.org.	IN	CNAME	myserver
</pre>

<h3>Installation on Windows: Apache HTTP Server or Microsoft IIS</h3>

<p>
In outline, the procedure to set up the LDAP Address Book to run
under Windows is as follows:
</p>

<ul>
<li>Install prefered web server (e.g. Apache HTTP Server or Microsoft IIS).

<li>Download PHP 5, e.g. from 
    <a href="http://windows.php.net/download/">http://windows.php.net/download/</a>
    or a trusted mirror.

<li>Install PHP 5, ensuring that LDAP support is enabled.

<li>Set up a new virtual host or folder for the Address Book and
    extract the install media to it.

<li>If necessary, create a DNS record for the address book web site.
</ul>

<h3>Set up access to the directory service</h3>
<p>
The LDAP Address Book will need at least one user login
account on the directory service in order to access its
contents. This can be either:
</p>
<ul>
<li>A generic "default" user account, which typically
    provides read-only access for searching or browsing records.
<li>Individual (named) login accounts (e.g. admin/editing
    permissions in future versions of the Address Book)
</ul>
<p>
If you just want to get the LDAP Address Book up and running
quickly, set up a new user account that provides read-only
access to your directory, open the file <code>config.php</code>
in your prefered text editor and fill in
<code>$ldap_default_user</code> and
<code>$ldap_default_password</code> with the account's
credentials.
</p>
<p>
You will also need to fill in the following settings:
</p>
<ul>
<li><code>$ldap_server_type</code> - Either <code>"ad"</code> (for either Microsoft or
Samba Active Directory), <code>"edir"</code> (Novell eDirectory) or "openldap" (OpenLDAP) as
appropriate.

<li><code>$ldap_link</code> - Enter the host name of the directory server
(domain controller) to connect to.

<li><code>$ldap_base_dn</code> - Set to the location in the directory (e.g. OU)
that should be used as the "root" of the address bok information.
</ul>
<p>
See the "Configuration Reference" section below for further
information on these and other settings.
</p>
<p>
Note: Windows users may experience problems opening the <code>config.php</code>
file using the Notepad text editor. Try downloading and using
Notepad++ instead, which supports correct handling of UNIX-style
newline characters.
</p>
<p>
Note: Some LDAP directory servers may allow read only access
with a blank user name/password ("anonymous
bind"). If this is the case then you may find that you
don't need to create a new user account or fill in
<code>$ldap_default_user</code> or <code>$ldap_default_password</code> at all.
</p>


<h2>Customising the Address Book</h2>

<h3>Configuring users and permissions</h3>
<p>
The LDAP address book supports logging in with named user
accounts. Typically, this would be used for administrators
who are permitted to edit the address book contents (in a
forthcoming future version), or to limit browsing/searching
access.
</p>
<p>
Set the following option in <code>config.php</code> to enable
different users to log into the directory:
</p>
<pre>
$ldap_login_enabled = true;
</pre>
<p>
Login users, passwords and permissions are taken from the
LDAP directory rather than the LDAP address book application
itself, according to information in the configuration
setting <code>$ldap_user_map</code>.
</p>
<ul>
<li>Each entry in <code>$ldap_user_map</code> specifies how a login name for
    the address book maps onto a back-end LDAP directory user
    and permissions.
<li>The special <code>__ANONYMOUS__</code> entry specifies the
    login details to use when nobody is logged in. This
    typically provides read-only access.
<li>The special <code>__DEFAULT__</code> entry applies to any
    valid LDAP login that does not have its own individual
    entry in the user map.
</ul>
<p>
Each entry in the user map may have the following permissions
set:
</p>
<table border=1>
<tr><th>Permission</th><th>Description</th></tr>
<tr><td><code>allow_browse</code></td><td>Allows the user to browse through
 OUs within the address book.</td></tr>
<tr><td><code>allow_search</code></td><td>Allows the user to search the
    address book directory tree.</td></tr>
<tr><td><code>allow_view</code></th><td>Allows the user to click on a record
    to see full details</td></tr>
</table>
<p>
When connecting to Active Directory, the <code>ldap_name</code>
setting should correspond to a user principal name (UPN), e.g. 
the user name followed by <code>@</code> followed by the DNS domain name.
The <code>__DEFAULT__</code> user map entry for the <code>example.org</code> AD domain
might be configured as follows:
</p>
<pre>
array("login_name"=>"__DEFAULT__","ldap_name"=>"__USERNAME__@example.org",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
        )
</pre>
<p>
(Replace <code>example.org</code> with a valid UPN suffix for your own
directory, e.g. the domain name itself).
</p>
<p>
The token <code>__USERNAME__</code> will be replaced with the name that was
entered into the login box. An LDAP login name of <code>__DENY__</code> will
deny access to the directory.
</p>
<p>
The following example will allow users to browse and search
without having to log in. (The LDAP directory will be accessed as
user <code>ldap-browse@example.org</code>, password
<code>foobar</code>), or an administrator to log on with user
name <code>admin</code>. The administrator's directory access
will utilis the login name <code>Administrator@example.org</code>.
</p>
<pre>
array("login_name"=>"admin","ldap_name"=>"Administrator@example.org",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
	),
array("login_name"=>"__DEFAULT__","ldap_name"=>"__DENY__",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
	),
array("login_name"=>"__ANONYMOUS__","ldap_name"=>"ldap-browse@example.org",
	"ldap_password="foobar",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
	)
</pre>
<p>
This allows only <code>admin</code> to log in, which is mapped to the directory's
<code>Administrator</code> user. (Other staff will be limited to anonymous read-only
access)
</p>
<p>
The following example will disable anonymous access, requiring users
to log in before they can browse the directory.
</p>
<pre>
array("login_name"=>"__DEFAULT__","ldap_name"=>"__USERNAME__@example.org",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
	),
array("login_name"=>"__ANONYMOUS__","ldap_name"=>"__DENY__",
	"ldap_password="foobar",
        "allow_browse"=>true,
        "allow_search"=>true,
        "allow_view"=>true
	)
</pre>
<h3>Changing the attributes shown for search results</h3>
<p>
The fields/attributes that are used when searching can
be customised by editing the contents of $search_ldap_attrib
in the config file. The default set of attributes that get
searched are:
</p>
<table border=1>
<tr><th>Attribute</th><th>Description (typical usage)</th></tr>
<tr><td><code>cn</code></td><td>Name of the directory entry itself (usually a person's full name or "common name")</td></tr>
<tr><td><code>mail</code></td><td>E-mail address</td></tr>
<tr><td><code>sn</code></td><td>Surname</td></tr>
<tr><td><code>displayName</code></td><td>Perfered display version of user's name. Some users may prefer informal versions of their name (e.g. "Andy" instead of "Andrew"), which would be represented here.</td></tr>
<tr><td><code>company</code></td><td>Company name</td></tr>
<tr><td><code>title</code></td><td>Job title</td></tr>
</table>
<p>
See you directory service's schema documentation for
other attributes which are available to be searched.
</p>
<p>
The columns that appear in search results can be changed
by editing the contents of <code>$search_result_columns</code> in the
config file.
</p>
<h3>Changing the layout and attributes shown for directory entries</h3>
<p>
You may want to customise the way in which address book
entries are displayed - which fields/attributes are
used and how they are laid out. The layout is set up
by editing the file <code>info.php</code>.
</p>
<p>
As shipped, address book entries are displayed in three
sections:
</p>

<img alt="Default address book layout, with personal, business/work and additinoal notes sections" src="layout.png">


<p>
The sections are created by calling $entry_viewer->add_section().
Sections are displayed side-to-side from left to right, unless
the NEW_ROW attribute is specified in order to create a new row. The layout above is created by
the following code:
</p>
<pre>
        $entry_viewer->add_section("Personal",NEW_ROW);

        $entry_viewer->add_section("Business/Work",NULL,NULL,"50%");

        $entry_viewer->add_section("Additional Notes",NEW_ROW,2);
</pre>
<p>
(In practice each call to $entry_viewer->add_section() is followed by
the fields to be added to that section)
</p>
<table border=1>
<tr><th colspan=2>General syntax for add_section()</th></tr>
<tr><td colspan=2><code>add_section($text,$newrow=false,$colspan="",$width="")</code></td></tr>
<tr><th>Attribute</th><th>Description</th></tr>
<tr><td><code>$text</code></td><td>Title to appear above the section</td></tr>
<tr><td><code>$newrow</code></td><td>Whether or not this section should start on a new row</td></tr>
<tr><td><code>$colspan</code></td><td>Number of HTML table columns that this section should span</td></tr>
<tr><td><code>$width</code></td><td>Width of the section</td></tr>
</table>

<p>
Entries are added to each section by making calls to <code>$entry_viewer->add_to_section()</code>.
The following line will add the "Prefered Name" field to the section last created
using <code>$entry_viewer->add_section()</code>:
</p>
<pre>
$entry_viewer->add_to_section("displayName","Preferred Name","contact24.png");
</pre>
<table border=1>
<tr><th colspan=2>General syntax for add_to_section()</th></tr>
<tr><td colspan=2><code>add_to_section($attribute,$caption="",$icon="")</code></td></tr>
<tr><th>Attribute</th><th>Description</th></tr>
<tr><td><code>$attribute</code></td><td>LDAP attribute (or list of attributes) to be displayed</td></tr>
<tr><td><code>$caption</code></td><td>Caption text to appear next to the attribute (leave blank for none)</td></tr>
<tr><td><code>$icon</code></td><td>Icon image to appear next to the attribute (leave blank for none)</td></tr>
</table>
<p>
To create display fields that are built from multiple LDAP attributes,
list the attributes in $attribute, seperating them with:
</p>
<table border=1>
<tr><th>Symbol</th><th>Meaning</th></tr>
<tr><td><code>:</code></td><td>Separate attributes with a line break</td></tr>
<tr><td><code>+</code></td><td>Separate attributes with a space</td></tr>
</table>
<p>
The following example will display a display field from the
LDAP attributes <code>streetAddress</code>, <code>l</code>,
<code>st</code> and <code>postalCode</code>, laying them out
as a UK postal address.
</p>
<pre>
$entry_viewer->add_to_section("streetAddress:l:st:postalCode","Postal Address","address.gif");
</pre>
<p>
If the address attributes in your LDAP directory are used to store
business addresses rather than personal addresses you may want
to move the "Address" field from the "Personal" to the "Business/Work"
section.
</p>

<ul>
<li><p>Any web page URLs and e-mail addresses will appear as
    clickable HTML links.</p>
<li><p>The <code>postalCode</code> attribute is followed by a
    "View Map" link that displays the corresponding location
    in Google Maps (where the postal code is valid and recognised).</p>
</ul>

<h3>Changing the look and formatting of the address book</h3>
<p>
The appearance (such as font, text size, colours, etc) of the
address book is defined in the file <code>styles.css</code>.
</p>
<p>
<a href="../styles.css">Take a look at the stylesheet file
(<code>styles.css</code>)</a>
</p>
<p>
You can change any of these settings (or add your own) by creating
your own stylesheet file, called <code>styles_local.css</code> and
adding your changes to it. (Although you could modify
<code>styles.css</code> directly it will be easier to upgrade to
future versions of the address book if you keep your changes
separate by using <code>styles_local.css</code> instead.)
</p>
<p>
The stylesheet file is made up of
<span style="font-style:italic">selectors</span> which specify which
part of the user interface is to be changed, followed by
<span style="font-style:italic">style directives</span> surrounded
by {...} to define how it should appear. For example, if you wanted to
dispay the address book in a different font you might add
the following to your own <code>styles_local.css</code> file and
change the <code>font-family</code> setting to your own choice of font:
</p>
<pre>
body,table {
        font-family:serif;
}
</pre>
<p>
Where you don't redefine a setting in <code>styles_local.css</code>
(such as <code>font-size:10pt</code> in this example) the value
from <code>styles.css</code> will continue to be used.
</p>
<p>
The following table summarises the CSS selectors used within
<code>styles.css</code> and which part of the address book's
appearance they affect:
</p>
<table border=1>
<tr><th>CSS Selector</th><th>Typically used to change the font, size,
        colour, etc, of...</th></tr>
<tr><td><code>body,table</code></td>
    <td>The address book as a whole.</td></tr>
<tr><td><code>.ldap_navigation_path th</code></td>
    <td>The address book title, which is shown as the left-most item in the
        "Navigation Path" shown at the top of each page.</td></tr>

<tr><td><code>.ldap_navigation_path td</code></td>
    <td>Organisational units, folders, etc, shown in the
        "Navigation Path" at the top of each page. The left-most
        element of the navigation path (typically used to show
        the address book title) is styled separately, described
        above.</td></tr>

<tr><td style="white-space:nowrap"><code>.ldap_entry_viewer_section .column_header,<br>
        .search_results_viewer .column_header</code></td>
    <td>Column headers/titles used in search results and
        directory entries.(*)</td></tr>

<tr><td><code>.ldap_entry_viewer_section td,<br>
        .search_results_viewer td</code></td>
    <td>Data displayed in search results and directory entries.(*)
        Note: The appearance of LDAP attributes can be customised
        individually, as described below.</td></tr>

<tr><td><code>.ldap_entry_viewer_section th</code></td>
    <td>Name/label text that appears to the left of each
        attribute shown in a directory entry.</td></tr>

</table>
<p>
(* These may be split into two separate style declarations if
you want to customise the search results and directory entry
detail pages separately.)
</p>
<p>
You can also change the way in which an individual LDAP attribute
is displayed by applying style directives to
 <code>.ldap_attribute_&lt;attrib&gt;</code>,
where <code>&lt;attrib&gt;</code> is the attribute to be
customised. <p>For example, adding the following to
<code>styles_local.css</code> will cause home telephone numbers
(stored in the <code>homePhone</code> attribute) to be displayed
in italic:
</p>
<pre>
.ldap_attribute_homePhone
{
        font-style:italic;
}
</pre>
<p>
As a further example, adding the following to <code>styles_local.css</code>
will display SSH public keys (stored in the <code>sshPublicKey</code>
attribute) to be displayed in a fixed-width font and word-wrapped more
appropriately:
</p>
<pre>
.ldap_attribute_sshPublicKey
{
        font-family:monospace;
        word-break:break-all;
}
</pre>

<h2>Configuration Reference</h2>
<p>
Edit the file <code>config.php</code>, which holds details of how the
address book links to the back-end LDAP directory and
how records are searched for and displayed.
</p>
<table border=1>
<tr><th>Setting</th><th>Description</th></tr>
<tr><td><code>$site_name</code></td><td>Site name, which appears in the browser title bar. You may want to
		customise this, e.g. with your company name.<p>Example: BigCorp Address Book</p></td></tr>

<tr><th colspan=2>Connection to LDAP Directory</th></tr>

<tr><td><code>$ldap_server_type</code></td><td>Indicate the LDAP server (directory) type, which affects
	how the directory's objects and their attributes are displayed in the address book. The following
	values are accepted:<br>&nbsp;<br>
<code>ad</code> - Microsoft Active Directory (or Samba 4 Active Directory)<br>
<code>edir</code> - Novell eDirectory<br>
<code>openldap</code> - OpenLDAP (core/inetorgperson schema)
</td></tr>

<tr><td><code>$ldap_link</code></td><td>Creates a connection to the LDAP server holding the address
    book data.

    <p>Example: ldap_connect("dc1.example.org")</>

<p>Active Directory-specific Options:</p><p>
    (1) As an alternative to giving the name of a specific server (domain controller) you can
    specify just the domain name. This will load balance the connections across the
    available domain controllers. (See Microsoft KB 842197 for further information
    on how to use DNS netmask ordering for more fine-grained control of the servers
    used for load balancing.)</p>
    <p>
    (2) For multi-domain forests, specify the LDAP port number as 3268 in order to
    use the AD Global Catalogue. (By comparison, using the default LDAP port (389)
    will return incomplete information other than for the local AD domain.)
    </p>
    <p>
    Examples:<br>
    ldap_connect("example.org") - load balances across the DCs as listed in DNS)<br>
    ldap_connect("dc1.example.org",3268) - use AD global catalogue port
    </p>
<p>
Further information see:<a href="http://www.php.net/manual/en/function.ldap-connect.php">
http://www.php.net/manual/en/function.ldap-connect.php</a>
</p>
</td></tr>

<tr><td><code>$ldap_base_dn</code></td><td>Specifies the search base within the directory which
    will be used for displaying the address book. Rather than searching the whole
    directory, you can use this option to restrict search results to only a
    specific OU hierarchy which contains the user accounts.
    <p>
    Examples: dc=example,dc=org<br>
    ou=Users,dc=example,dc=org
    </p>
    <p>
    Example config file syntax where one of the OU names contains a space:<br>
    $ldap_base_dn = "ou=User Accounts,dc=example,dc=org";<br>
    </p>
</td></tr>

<tr><td><code>$ldap_default_user</code><br><code>$ldap_default_password</code></td>
    <td>These specify the user name and password which are used by the
    address book software to access the LDAP directory service (also
    known as "binding" to the directory). If you have enabled
    authenticated access to the directory then these settings will
    be used only when nobody is logged in (e.g. to provide read-only
    access).
    <p>
    Example user names:<br>
    cn=LDAPUser,cn=Users,dc=example,dc=org<br>
    cn=LDAPUser,dc=MyDirectory<br>
    LDAPUser@example.org (Active Directory specific syntax)
    
    </p>
    <p>If the directory is set up to allow read access without having
    to log on then just leave the user name and password blank
    (which will perform an "anonymous bind").</p>

<tr><td><code>$ldap_user_map</code></td>
    <td>Specifies the mapping between address book logins and the
    back-end directory (see "Configuring users and permissions" above).

<tr><th colspan=2>Search/Browse Directory Settings</th></tr>

<tr><td><code>$search_ldap_attrib</code></td>
    <td>This specifies which attributes (fields) get searched when a
     user searches the address book. Add to the list if you have
     specific requirements, e.g. if you want users to be able to
     search on a department name (department) or building
     (physicalDeliveryOfficeName).</td></tr>

<tr><td><code>$search_result_columns</code></td>
    <td>Specifies the column layout to be used for displaying
    search results. Each column has three fields associated with it:
    <ul>
    <li>caption - Caption to appear in column heading
    <li>attrib - LDAP attribute to display
    <li>link_type - Whether to display the attribute as a hyperlink
    </ul>
    The special attribute "sortableName" will display constructed
    "sort-friendly" version of a personal name (Surname, Firstname)
    based on which LDAP attributes are populated. (Ideally
    sn and givenName if populated, otherwise falling back to
    displayName or cn.) The following link types are supported:
    <ul>
    <li>object - Link to the object record. Recommended to use this
    link type for the object name, displayed in the left-most column.
    <li>mailto - Display as mailto: link, e.g. for attributes containing
    e-mail addresses.
    <li>none - Do not display as a link.
    </ul>
    Example:
    <pre>
$search_result_columns = array(
        array("caption"=>"Name",                "attrib"=>"sortableName",       "link_type"=>"object"),
        array("caption"=>"E-Mail",              "attrib"=>"mail",               "link_type"=>"mailto"),
        array("caption"=>"Organisation",        "attrib"=>"company",            "link_type"=>"none")
        );</pre>
</td></tr>

<tr><td><code>$search_result_default_sort_order</code></td>
    <td>Specifies the default sort order for displaying search
     results. User can change the sort order by clicking a column
     header.</td></tr>
</table>

</body>
</html>
